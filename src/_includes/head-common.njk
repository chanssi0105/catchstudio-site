{# src/_includes/head-common.njk #}
{# ----------------------------
  기본값 / 페이지별 오버라이드 (Nunjucks 안전버전)
  - 각 페이지 front matter에서 title, description, canonical, ogImage, noindex 등 지정 가능
---------------------------- #}

{% set SITE_NAME = (site and site.name) or "Catch Studio" %}
{% set SITE_URL  = (site and site.url)  or "https://catch-studio.com" %}

{# =========================
  i18n helpers (KO root + EN /en)
========================= #}
{% set url = page.url or "/" %}
{% set isEn = false %}
{% if url == "/en/" or url.startsWith("/en/") %}
  {% set isEn = true %}
{% endif %}

{# KO/EN path 계산 (삼항 제거) #}
{% set koPath = url %}
{% if isEn %}
  {% if url == "/en/" %}
    {% set koPath = "/" %}
  {% else %}
    {% set koPath = (url | replace("/en/","/")) %}
  {% endif %}
{% endif %}

{% set enPath = url %}
{% if not isEn %}
  {% if url == "/" %}
    {% set enPath = "/en/" %}
  {% else %}
    {% set enPath = "/en" ~ url %}
  {% endif %}
{% endif %}

{% set LOCALE = (site and site.locale) or "ko_KR" %}
{% if isEn %}
  {% set LOCALE = "en_US" %}
{% endif %}

{# title #}
{% set pageTitle = SITE_NAME %}
{% if site and site.defaultTitle %}
  {% set pageTitle = site.defaultTitle %}
{% endif %}
{% if title %}
  {% set pageTitle = SITE_NAME ~ " | " ~ title %}
{% endif %}

{# description #}
{% set pageDesc = "Catch Studio 포트폴리오" %}
{% if site and site.defaultDescription %}
  {% set pageDesc = site.defaultDescription %}
{% endif %}
{% if description %}
  {% set pageDesc = description %}
{% endif %}

{# canonical #}
{% set canonicalUrl = SITE_URL ~ url %}
{% if canonical %}
  {% set canonicalUrl = canonical %}
{% endif %}

{# OG/Twitter 이미지 #}
{% set ogImg = "/assets/images/og/default-og.png" %}
{% if site and site.defaultOgImage %}
  {% set ogImg = site.defaultOgImage %}
{% endif %}
{% if ogImage %}
  {% set ogImg = ogImage %}
{% endif %}

{# OG 이미지 절대경로화 (JS indexOf 제거, slice로 안전 처리) #}
{% set ogImgAbs = "" %}
{% if ogImg %}
  {% if (ogImg | slice(0,4)) == "http" %}
    {% set ogImgAbs = ogImg %}
  {% else %}
    {% set ogImgAbs = SITE_URL ~ ogImg %}
  {% endif %}
{% endif %}

{# OG type #}
{% set ogTypeFinal = ogType or "website" %}

{# theme-color #}
{% set themeLight = "#ffffff" %}
{% set themeDark  = "#0b0b0b" %}
{% if site and site.themeColorLight %}
  {% set themeLight = site.themeColorLight %}
{% endif %}
{% if site and site.themeColorDark %}
  {% set themeDark = site.themeColorDark %}
{% endif %}
{% if themeColorLight %}
  {% set themeLight = themeColorLight %}
{% endif %}
{% if themeColorDark %}
  {% set themeDark = themeColorDark %}
{% endif %}

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

<meta name="color-scheme" content="light dark" />
<meta name="theme-color" media="(prefers-color-scheme: light)" content="{{ themeLight }}" />
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="{{ themeDark }}" />

<title>{{ pageTitle }}</title>
<meta name="description" content="{{ pageDesc }}" />
<link rel="canonical" href="{{ canonicalUrl }}" />

<link rel="alternate" hreflang="ko" href="{{ SITE_URL ~ koPath }}" />
<link rel="alternate" hreflang="en" href="{{ SITE_URL ~ enPath }}" />
<link rel="alternate" hreflang="x-default" href="{{ SITE_URL ~ koPath }}" />

{% if noindex %}
<meta name="robots" content="noindex, nofollow" />
{% else %}
<meta name="robots" content="index, follow" />
{% endif %}

<meta property="og:type" content="{{ ogTypeFinal }}" />
<meta property="og:site_name" content="{{ SITE_NAME }}" />
<meta property="og:title" content="{{ pageTitle }}" />
<meta property="og:description" content="{{ ogDescription or pageDesc }}" />
<meta property="og:url" content="{{ canonicalUrl }}" />
<meta property="og:locale" content="{{ LOCALE }}" />
{% if ogImgAbs %}
<meta property="og:image" content="{{ ogImgAbs }}" />
{% endif %}

<meta name="twitter:card" content="{{ twitterCard or 'summary_large_image' }}" />
<meta name="twitter:title" content="{{ pageTitle }}" />
<meta name="twitter:description" content="{{ twitterDescription or pageDesc }}" />
{% if ogImgAbs %}
<meta name="twitter:image" content="{{ ogImgAbs }}" />
{% endif %}

<link rel="icon" href="/assets/images/favicon.ico?v=1" sizes="any" />
<link rel="icon" type="image/svg+xml" href="/assets/images/icon.svg" />
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png" />

<link rel="preload" href="/assets/fonts/pretendard/PretendardVariable.woff2" as="font" type="font/woff2" crossorigin />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />

<link rel="stylesheet" href="/assets/css/common.css" />
<link rel="stylesheet" href="/assets/css/main.css" />

{% if isProject %}
  <link rel="stylesheet" href="/assets/css/projects/project-base.css" />
{% endif %}

{% if globalJs is not defined or globalJs %}
<script defer src="/assets/js/main.js"></script>
{% endif %}

<meta name="google-site-verification" content="a7UBLHCuWw5ByyizcyUTnhjww2oG5R2cEPNWn356Y1k" />